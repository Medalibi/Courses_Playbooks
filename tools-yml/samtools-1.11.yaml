  - name: Download and extract Samtools archives
    unarchive:
      src:  '{{ item }}'
      dest: /usr/local/
      remote_src: yes
      mode: '0777'
    with_items:
      - "https://github.com/samtools/htslib/releases/download/1.11/htslib-1.11.tar.bz2"
      - "https://github.com/samtools/samtools/releases/download/1.11/samtools-1.11.tar.bz2"
      - "https://github.com/samtools/bcftools/releases/download/1.11/bcftools-1.11.tar.bz2"

  - name: Install Samtools dependencies
    apt:
      name: "{{ packages }}"
      update_cache: yes
    vars:
      packages:
      - zlib1g-dev
      - libbz2-dev
      - libncurses5-dev
      - libncursesw5-dev
      - liblzma-dev
      - gcc
      - make
      - libcurl4-openssl-dev
      - libssl-dev
      - autoconf

  - name: Compile Samtools
    shell: |
      autoheader
      autoconf
      ./configure --enable-libgsl --enable-perl-filters
      make
      make install
    args:
      chdir: "{{ item }}"
    with_items:
      - "/usr/local/htslib-1.11"
      - "/usr/local/samtools-1.11"
      - "/usr/local/bcftools-1.11"
